<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1" /> <title>Wfuzz高阶功法 · Chen's Blog</title> <meta name="description" content="Wfuzz高阶功法"> <meta name="keywords" content="Wfuzz高阶功法"> <link rel="icon" href="http://localhost:4000/assets/favicon.png"> <link rel="apple-touch-icon" href="http://localhost:4000/assets/touch-icon.png"> <link rel="stylesheet" href="http://localhost:4000/assets/core.css"> <link rel="canonical" href="http://localhost:4000/archives/2018-10-28/3"> <link rel="alternate" type="application/atom+xml" title="Chen's Blog" href="http://localhost:4000/feed.xml" /> <link href="/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" media="all" /> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?e4a42a371cc5994ee02b940034c29658"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script> </head> <body> <aside class="logo"> <a href="http://localhost:4000/"> <img src="/assets/avatar.jpg" class="logo-avatar"> </a> <span class="logo-prompt code">Back to Index</span> </aside> <article> <h1 class="title">EvilChen</h1> <div class="divider"></div> <center> <a href="https://github.com/gh0stkey" target="_blank">Github</a> | <a href="https://twitter.com/VulkeyChen" target="_blank">X (Twitter)</a> | <a href="/about" target="_blank">About</a> | <a href="/friends" target="_blank">Friends</a> </center> <div class="divider"></div> </article> <div id="content"> <article> <div class="center"> <h1 class="title">Wfuzz高阶功法</h1> <time class="code">October 28, 2018</time> </div> <div class="divider"></div> <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&auto=1&id=557583281&height=66"></iframe> <h1 id="wfuzz高阶功法">Wfuzz高阶功法</h1> <p>Author: Vulkey_Chen</p> <p>Blog: gh0st.cn</p> <h2 id="模块">模块</h2> <p>之前两篇文章中已经记录过了payloads和printers模块，所以就不在这继续记录。</p> <h3 id="iterators">Iterators</h3> <p>BurpSuite的<code class="language-plaintext highlighter-rouge">Intruder</code>模块中Attack Type有Sniper(狙击手)、Battering ram(撞击物)、Pitchfork(相交叉)、Cluster bomb(集束炸弹)～</p> <p>wfuzz也可以完成这样的功能，将不同的字典的组合起来，那就是<code class="language-plaintext highlighter-rouge">Iterators</code>模块。</p> <p>使用参数<code class="language-plaintext highlighter-rouge">-m 迭代器</code>，wfuzz自带的迭代器有三个：<code class="language-plaintext highlighter-rouge">zip</code>、<code class="language-plaintext highlighter-rouge">chain</code>、<code class="language-plaintext highlighter-rouge">product</code>，如果不指定迭代器，默认为<code class="language-plaintext highlighter-rouge">product</code>迭代器。</p> <h4 id="zip">zip</h4> <p>命令：</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-z</span> range,0-9 <span class="nt">-w</span> dict.txt <span class="nt">-m</span> zip http://127.0.0.1/ip.php?FUZZ<span class="o">=</span>FUZ2Z
</code></pre></div></div> <p>结果如下：</p> <p><img src="/images/2018-10-28/0x04.png" alt="0x04" /></p> <p>该命令的意思：设置了两个字典。两个占位符，一个是<code class="language-plaintext highlighter-rouge">range</code>模块生成的<code class="language-plaintext highlighter-rouge">0、1、2、3、4、5、6、7、8、9 </code> 10个数字，一个是外部字典dict.txt的9行字典，使用<strong>zip迭代器组合这两个字典</strong>发送。</p> <p><strong>zip迭代器的功能</strong>：字典数相同、一一对应进行组合，<strong>如果字典数不一致则多余的抛弃掉不请求，如上命令结果就是数字9被抛弃了因为没有字典和它组合</strong>。</p> <h4 id="chain">chain</h4> <p>命令：</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-z</span> range,0-9 <span class="nt">-w</span> dict.txt <span class="nt">-m</span> chain http://127.0.0.1/ip.php?FUZZ
</code></pre></div></div> <p>结果如下：</p> <p><img src="/images/2018-10-28/0x05.png" alt="0x05" /></p> <p>该命令设置了两个字典，一个占位符FUZZ，<strong>使用chain迭代器组合这两个字典</strong>发送。</p> <p><strong>chain迭代器的功能</strong>：通过返回结果就能看出来<code class="language-plaintext highlighter-rouge">chain</code>迭代器的功能了，<strong>这个迭代器是将所有字典全部整合（不做组合）放在一起然后传入占位符FUZZ</strong>中。</p> <h4 id="product">product</h4> <p>命令：</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-z</span> range,0-2 <span class="nt">-w</span> dict.txt <span class="nt">-m</span> product http://127.0.0.1/ip.php?FUZZ<span class="o">=</span>FUZ2Z
</code></pre></div></div> <p>结果如下：</p> <p><img src="/images/2018-10-28/0x06.png" alt="0x06" /></p> <p>该命令的意思：设置了两个字典，两个占位符，一个是<code class="language-plaintext highlighter-rouge">range</code>模块生成的<code class="language-plaintext highlighter-rouge">0、1、2</code> 3个数字，一个是外部字典dict.txt的3行字典，使用<strong>product迭代器组合这两个字典</strong>发送。</p> <p><strong>product迭代器的功能</strong>：通过返回结果，知道了请求总数为9，请求的payload交叉组合：</p> <p><img src="/images/2018-10-28/0x07.png" alt="0x07" /></p> <h3 id="encoders">Encoders</h3> <p>wfuzz中<strong>encoders模块</strong>可以实现编码解码、加密，它支持如下图中所列转换功能：</p> <p><img src="/images/2018-10-28/0x08.png" alt="0x08" /></p> <h4 id="使用encoders">使用Encoders</h4> <p><strong>正常使用：</strong></p> <ul> <li> <p><code class="language-plaintext highlighter-rouge">wfuzz -z file --zP fn=wordlist,encoder=md5 URL/FUZZ</code></p> <p>看过第一章的应该都能理解意思了，这里新增的就是<code class="language-plaintext highlighter-rouge">encoder=md5</code>，也就是使用<code class="language-plaintext highlighter-rouge">Encoders</code>的<code class="language-plaintext highlighter-rouge">md5</code>加密。</p> </li> <li> <p><code class="language-plaintext highlighter-rouge">wfuzz -z file,wordlist,md5 URL/FUZZ</code></p> <p>这里简写了第一条命令，一般都使用这条命令来调用Encoders</p> </li> </ul> <p><strong>使用多个Encoder：</strong></p> <ul> <li> <p>多个转换，使用一个<code class="language-plaintext highlighter-rouge">-</code>号分隔的列表来指定</p> <p><code class="language-plaintext highlighter-rouge">wfuzz -z file,dict.txt,md5-base64 http://127.0.0.1/ip.php\?FUZZ</code></p> <p><img src="/images/2018-10-28/0x09.png" alt="0x09" /></p> </li> <li> <p>多次转换，使用一个<code class="language-plaintext highlighter-rouge">@</code>号分隔的列表来按照<strong>从右往左顺序</strong>多次转换（这里让传入的字典先md5加密然后base64编码）</p> <p><code class="language-plaintext highlighter-rouge">wfuzz -z file,dict.txt,base64@md5 http://127.0.0.1/ip.php\?FUZZ</code></p> <p><img src="/images/2018-10-28/0x10.png" alt="0x10" /></p> </li> </ul> <h3 id="scripts">Scripts</h3> <p>之前说了wfuzz支持插件，其本身也有很多插件，插件大部分都是实现扫描和解析功能，插件共有两大类和一类附加插件：</p> <ul> <li>passive：分析已有的请求和响应（被动）</li> <li> <p>active：会向目标发送请求来探测（主动）</p> </li> <li>discovery：自动帮助wfuzz对目标站进行爬取，将发现的内容提供给wfuzz进行请求</li> </ul> <p>Wfuzz默认自带脚本如下：</p> <p><img src="/images/2018-10-28/0x11.png" alt="0x11" /></p> <h4 id="使用scripts">使用Scripts</h4> <p>我想使用<code class="language-plaintext highlighter-rouge">Scripts</code>中的<code class="language-plaintext highlighter-rouge">backups</code>模块，可以先试用<code class="language-plaintext highlighter-rouge">--script-help</code>参数来看如何关于这个模块的信息：</p> <p><code class="language-plaintext highlighter-rouge">wfuzz --script-help=robots</code></p> <p><img src="/images/2018-10-28/0x12.png" alt="0x12" /></p> <p>从如上结果中可以知道这个模块不需要设置参数，该模块解析robots.txt的并且寻找新的内容，，至于到底寻找什么，就需要动手实践下了～</p> <p>在本地建一个robots.txt：</p> <p><img src="/images/2018-10-28/0x13.png" alt="0x13" /></p> <p>使用如下命令：</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">--script</span><span class="o">=</span>robots <span class="nt">-z</span> list,<span class="s2">"robots.txt"</span> http://127.0.0.1/FUZZ
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">--script</code>是使用脚本模块的参数，这时候就有个疑惑命令为什么要加上list呢？因为在这里<code class="language-plaintext highlighter-rouge">robots</code>脚本只是解析<code class="language-plaintext highlighter-rouge">robots.txt</code>规则的，所以你需要告诉wfuzz去请求哪个文件而这里我写的就是<code class="language-plaintext highlighter-rouge">robots.txt</code>就可以解析（假设 http://127.0.0.1/t.txt 的内容也是robots的就可以写成这样的命令<code class="language-plaintext highlighter-rouge">wfuzz --script=robots -z list,"t.txt" http://127.0.0.1/FUZZ</code> ）</p> <p><img src="/images/2018-10-28/0x14.png" alt="0x14" /></p> <p>从如上图中得知wfuzz解析robots.txt的内容然后请求解析之后获得的路径。</p> <h4 id="自定义插件">自定义插件</h4> <p>使用wfuzz可以自己编写wfuzz插件，需要放在<code class="language-plaintext highlighter-rouge">~/.wfuzz/scripts/</code>目录下，具体如何编写可以参考已有的插件：https://github.com/xmendez/wfuzz/tree/master/src/wfuzz/plugins/scripts</p> <h2 id="技巧">技巧</h2> <h3 id="recipes">Recipes</h3> <p>Wfuzz可以生成一个recipes用来保存命令，方便下次执行或者分享给别人。</p> <p>生成一个recipes：</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">--script</span><span class="o">=</span>robots <span class="nt">-z</span> list,<span class="s2">"robots.txt"</span> <span class="nt">--dumo-recipe</span> outrecipe URL/FUZZ
</code></pre></div></div> <p>使用某个recipes：</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">--recip</span> outrecipe
</code></pre></div></div> <h3 id="网络异常">网络异常</h3> <p>Wfuzz扫描的时候出现网络问题，如DNS解析失败，拒绝连接等时，wfuzz会抛出一个异常并停止执行使用<code class="language-plaintext highlighter-rouge">-Z</code>参数即可忽略这些错误继续执行。</p> <p>出现错误的payload会以返回码<code class="language-plaintext highlighter-rouge">XXX</code>来表示，<strong>Payload中还有出现的错误信息</strong>。</p> <h3 id="超时">超时</h3> <p>使用wfuzz扫描会遇到一些响应很慢的情况，wfuzz可以设置超时时间。</p> <p>参数<code class="language-plaintext highlighter-rouge">--conn-delay</code>来设置wfuzz等待服务器响应接连的秒数。 参数<code class="language-plaintext highlighter-rouge">--req-delay</code>来设置wfuzz等待响应完成的最大秒数。</p> <h3 id="结合burpsuite">结合BurpSuite</h3> <p>从Burp的LOG文件中获取测试的URL地址：</p> <p><img src="/images/2018-10-28/0x15.png" alt="0x15" /></p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-z</span> burplog,<span class="s2">"1.burp"</span> FUZZ
</code></pre></div></div> <p><img src="/images/2018-10-28/0x16.png" alt="0x16" /></p> <p>还有能够读取burpsuite保存的state：</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-z</span> burpstate,a_burp_state.burp FUZZ
</code></pre></div></div> <h3 id="过滤器">过滤器</h3> <p>这里篇幅太长，建议综合参考 https://github.com/xmendez/wfuzz/blob/18a83606e3011159b4b2e8c0064f95044c3c4af5/docs/user/advanced.rst 就不一一写出来了。</p> </article> <div class="page-navigation code"> <a class="next" href="http://localhost:4000/archives/2018-11-14/2" title="NEXT: 浅析PDF事件导致的安全漏洞">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="http://localhost:4000/" title="Back to Index">INDEX</a> <span> &middot; </span> <a class="prev" href="http://localhost:4000/archives/2018-10-28/2" title="PREV: Wfuzz基本功">&gt;&gt;</a> </div> </div> <div class="footer"> <span class="block">&lt;/&gt; Copyright &copy; Chen's Blog (GH0ST.CN) 2016-2021</span> </div> <script src="/fancybox/lib/jquery-1.10.2.min.js"></script> <script type="text/javascript" src="/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script> <script> $(document).ready(function() { $("article img").each(function() { var strA = "<a style='text-decoration: none;' id='imgid' href='" + this.src + "'></a>"; $(this).wrapAll(strA); }); $(".block").html("&lt;/&gt; Copyright &copy; Chen's Blog (GH0ST.CN) 2016-" + (new Date()).getFullYear()); }); $("#imgid").fancybox({ openEffect : 'elastic', closeEffect : 'elastic', }); </script> </body> </html>
