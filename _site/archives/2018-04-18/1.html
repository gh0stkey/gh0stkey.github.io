<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1" /> <title>Web安全测试学习手册-业务逻辑测试 · Chen's Blog</title> <meta name="description" content="首先感谢朋友倾璇的邀请 http://payloads.online/archivers/2018-03-21/1 ，参与了的相关撰写，目前负责业务逻辑测试这一块的撰写，目前初步已经成型，先发出来让大家看看，欢迎点评，也可以加入我们一起来撰写~"> <link rel="icon" href="http://localhost:4000/assets/favicon.png"> <link rel="apple-touch-icon" href="http://localhost:4000/assets/touch-icon.png"> <link rel="stylesheet" href="http://localhost:4000/assets/core.css"> <link rel="canonical" href="http://localhost:4000/archives/2018-04-18/1"> <link rel="alternate" type="application/atom+xml" title="Chen's Blog" href="http://localhost:4000/feed.xml" /> <link href="/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" media="all" /> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?e4a42a371cc5994ee02b940034c29658"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script> </head> <body> <aside class="logo"> <a href="http://localhost:4000/"> <img src="/assets/avatar.jpg" class="logo-avatar"> </a> <span class="logo-prompt code">Back to Index</span> </aside> <article> <h1 class="title">ᴀᴜᴛʜᴏʀ: ᴠᴜʟᴋᴇʏ_ᴄʜᴇɴ</h1> <div class="divider"></div> <center><a href="/about" target="_blank">ᴀʙᴏᴜᴛ</a> | <a href="/links" target="_blank">ʟɪɴᴋs</a> | <a href="/AssistTool" target="_blank">ᴀssɪsᴛ ᴛᴏᴏʟ</a> | <a href="/RGPerson" target="_blank">ʀɢᴘᴇʀsᴏɴ</a> | <a href="/Binary-Learning" target="_blank">ʙɪɴᴀʀʏ ʟᴇᴀʀɴɪɴɢ</a></center> <div class="divider"></div> </article> <div id="content"> <article> <div class="center"> <h1 class="title">Web安全测试学习手册-业务逻辑测试</h1> <time class="code">April 18, 2018</time> </div> <div class="divider"></div> <p>首先感谢朋友倾璇的邀请 http://payloads.online/archivers/2018-03-21/1 ，参与了<web安全测试学习手册>的相关撰写，目前负责业务逻辑测试这一块的撰写，目前初步已经成型，先发出来让大家看看，欢迎点评，也可以加入我们一起来撰写~</web安全测试学习手册></p> <h1 id="业务逻辑测试">业务逻辑测试</h1> <p>介绍：这里对Web应用业务逻辑方面的安全缺陷进行介绍和常见案例讲解。 <!-- more --></p> <h2 id="任意用户密码重置">任意用户密码重置</h2> <h3 id="常见的缺陷">常见的缺陷</h3> <h4 id="-1验证码类缺陷">* 1.验证码类缺陷</h4> <p>-场景： 1.1 验证码回显在客户端(响应主体、Set-Cookie等等…)。</p> <p>1.2 验证码过于简易时效性过长，接口未做限制(一般为纯数字4-8位数，时效性长达30分钟以上可以对验证码进行枚举)。</p> <h4 id="-2未校验权限前端校验越权">* 2.未校验权限/前端校验/越权</h4> <p>-场景： 2.1 任意手机号验证码都可重置任意账号。</p> <p>2.2 修改响应包的主体(根据实际情况来修改 例如验证请求对应的响应报文的主体为<code class="language-plaintext highlighter-rouge">false</code> 你可以修改为<code class="language-plaintext highlighter-rouge">true</code>)。</p> <p>2.3 同一浏览器进入A用户的重置，然后关闭再进入B用户的重置 而实际上重置A用户。</p> <p>2.4 修改重置密码的相关参数(例如 userid等等…)。</p> <h4 id="-3host头伪造">* 3.HOST头伪造</h4> <p>-场景： 3.1 在邮箱找回密码的时候，可以简单替换Host部分进行Fuzz，看看找回密码的链接中的域名是否是根据Host来生成的如果是可以替换成自己的域名。但是这种思路很鸡肋，因为需要用户的点击，这样才可以根据日志看到重置密码的链接，万一重置密码的链接时效性过去就无奈了。</p> <h4 id="-4找回密码的凭证脆弱">* 4.找回密码的凭证脆弱</h4> <p>-场景： 4.1 见过最多的是找回密码的token是base64编码的，而解码后的明文根据其规则修改就可以成为别人用户找回密码的凭证了。</p> <h2 id="验证码绕过">验证码绕过</h2> <h3 id="常见的缺陷-1">常见的缺陷</h3> <h4 id="图形类验证码绕过">图形类验证码绕过</h4> <h5 id="-1图形验证码可复用">* 1.图形验证码可复用</h5> <p>-场景： 3.1 验证码刷新之后，而历史刷新的验证码还是可以继续使用。</p> <p>3.2 验证码使用过后不刷新，时效性不过期，可以一直复用。</p> <h5 id="-2图形验证码易识别">* 2.图形验证码易识别</h5> <p>-场景 4.1 很多验证码的显示很简单，容易被机器识别。</p> <h4 id="短信类验证码绕过">短信类验证码绕过</h4> <h5 id="-1验证码过于简易接口未限制">* 1.验证码过于简易&amp;接口未限制</h5> <p>-场景： 1.1 有些手机短信验证码都为 4-8位 纯数字的验证码，在接口没有任何限制的情况下是可以直接爆破的。</p> <h5 id="-2验证码发送复用时效性过长接口未限制">* 2.验证码发送复用&amp;时效性过长&amp;接口未限制</h5> <p>-场景： 2.1 6位数验证码时效性为5分钟，但是在这里同一手机号发送的验证码都是一样的，所以可以在4分钟的时候重新发送一次验证码这样验证码就又有效了，因为验证码一直在被复用，所以可以爆破。</p> <h5 id="-3万能验证码">* 3.万能验证码</h5> <p>-场景： 3.1 这是很多大企业的诟病，在未上线前为了方便测试加了<code class="language-plaintext highlighter-rouge">888888</code>、<code class="language-plaintext highlighter-rouge">000000</code>这样的万能验证码但是上线后没去删除测试的内容导致被恶意利用。</p> <h2 id="短信语音验证码重放">短信/语音验证码重放</h2> <p>无论是发送短信还是语音验证码来做验证，都是需要手机号的，而发送验证码实际上是需要成本的，需要跟运营商或者是第三方验证码平台进行合作，多数验证码为0.01元一条，当然也有更便宜的，所以这边的问题也会影响到一个企业的资产方面。</p> <h3 id="常见缺陷">常见缺陷</h3> <h4 id="-1无限制发送">* 1.无限制发送</h4> <p>-场景： 1.1 厂商对验证码发送这一块并没有进行限制时间发送</p> <h4 id="-2代码层逻辑校验问题">* 2.代码层逻辑校验问题</h4> <p>-场景： 2.1 很多厂商会对手机号进行限制，如果60秒内发送过就不会发送，但是程序员在设计代码层的逻辑时会出现很多奇葩的问题，例如其为了方便用户体验，正常的代码层的流程为：</p> <p><code class="language-plaintext highlighter-rouge">a.去除用户手误输入的空格以及一些特殊符号</code></p> <p><code class="language-plaintext highlighter-rouge">b.验证手机号是否发送过验证码</code></p> <p>某些程序员会这样设计流程：</p> <p><code class="language-plaintext highlighter-rouge">a.验证手机号是否发送过验证码（发送过则不放行 没发送过则进入下一步）</code></p> <p><code class="language-plaintext highlighter-rouge">b.去除用户手误输入的空格以及一些特殊符号</code></p> <p><code class="language-plaintext highlighter-rouge">c.发送手机号验证码</code></p> <h4 id="-3手机号可遍历发送">* 3.手机号可遍历发送</h4> <p>-场景： 3.1 我之前有提到验证码发送会影响到企业资产，那么发送验证码限制就不能仅仅针对于单一手机号的限制，例如我可以载入一堆手机号的字典，然后直接遍历发送验证码，这也是危害之一。</p> <h2 id="业务流程绕过">业务流程绕过</h2> <h3 id="常见缺陷-1">常见缺陷</h3> <h5 id="-1无验证步骤跳跃">* 1.无验证步骤跳跃</h5> <p>-场景： 1.1 出现的场景很多：密码重置步骤、支付步骤，对于这种的测试方法有很多中：</p> <p>a.对比法，使用A、B两个账号，A账号先正常走一遍流程，然后记录流程的请求报文跟响应报文，使用B账号来测试是否能绕过直接进入最后一步骤。</p> <p>b.第六感，假设步骤1的网址为:<code class="language-plaintext highlighter-rouge">http://www.test.com/step1</code>，这时候你可以凭借你的第六感修改下链接为<code class="language-plaintext highlighter-rouge">/step2</code>之类的来测试。</p> <h2 id="加密算法脆弱">加密算法脆弱</h2> <h3 id="常见缺陷-2">常见缺陷</h3> <h4 id="-1前端呈现加密算法代码">* 1.前端呈现加密算法代码</h4> <p>-场景： 1.1 很多厂商算法写的很好，可没用，因为他用的是JS代码，在前端会直接能看见，而尝试跟踪JS的代码就会知道是怎么加密的从而可以直接绕过。</p> <h4 id="-2算法脆弱明文可判断">* 2.算法脆弱，明文可判断</h4> <p>-场景： 2.1 这是一个看运气的问题，一段密文为md5的，这时候你要做好自己的分析明文到底是什么，然后去碰撞，例如可能是<strong>md5(用户名+邮箱)</strong>这样的的组合。</p> <h2 id="支付逻辑漏洞">支付逻辑漏洞</h2> <h3 id="常见缺陷-3">常见缺陷</h3> <h4 id="-1金额修改">* 1.金额修改</h4> <p>-场景： 1.1 支付的过程中有很多涉及金额的元素可以修改运费、优惠价、折扣等，可以修改为负数金额也可以修改金额为小于原金额的数进行测试，有时候会遇到<code class="language-plaintext highlighter-rouge">溢出</code>，你修改金额为较大的数看你会出现只支付1元的情况。</p> <h4 id="-2数量修改">* 2.数量修改</h4> <p>-场景： 2.1 修改购买物品的数量为小数或者负数，同上，有时候会遇到<code class="language-plaintext highlighter-rouge">溢出</code>，你修改数量为较大的数看你会出现只支付1元的情况。</p> <h4 id="-3sign值可逆">* 3.sign值可逆</h4> <p>-场景： 3.1 这是一个看运气的问题，sign多数为对比确认金额的一段内容，很多都是md5加密的，这时候你要做好自己的分析明文到底是什么，然后去碰撞，例如可能是<strong>md5(订单号+金额)</strong>这样的的组合，然后修改金额重新生成sign就可以绕过金额固定的限制了。</p> <h2 id="条件竞争http并发">条件竞争(HTTP并发)</h2> <h3 id="常见缺陷-4">常见缺陷</h3> <h4 id="-1条件竞争http并发">* 1.条件竞争（HTTP并发）</h4> <p>-场景： 1.1 在签到、转账、兑换、购买等场景是最容易出现这样的问题，而并发测试的方法可以使用Fiddler也可以使用BurpSuite Intruder模块。</p> <p>这里例举下Fiddler测试方法（BurpSuite测试很简单就不说明了）：</p> <p>配置好代理，设置好拦截：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2018-04-18/0x00.png" alt="0x00.png" /></p> <p>然后点击兑换、转账、签到等最后一步按钮的时候会抓到一个请求，右键这一请求然后按住Shift点击Replay-&gt;Reissue Requests：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2018-04-18/0x01.png" alt="0x01.png" /></p> <p>填入要重发的次数：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2018-04-18/0x02.png" alt="0x02.png" /></p> <p>一般为20即可，然后点击GO放行：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2018-04-18/0x03.png" alt="0x03.png" /></p> <p>最后看你自己来判断是否存在并发的问题，例如签到，如果存在那么肯定是签到天数或者签到所获得的奖励会一下子有很多，也可以看Fiddler中的响应报文结果。</p> </article> <div class="page-navigation code"> <a class="next" href="http://localhost:4000/archives/2018-04-28/1" title="NEXT: CSRF之你登陆我的账号#业务逻辑组合拳劫持你的权限">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="http://localhost:4000/" title="Back to Index">INDEX</a> <span> &middot; </span> <a class="prev" href="http://localhost:4000/archives/2018-04-08/1" title="PREV: 二维码登陆的常见缺陷剖析">&gt;&gt;</a> </div> </div> <div class="footer"> <span class="block">&lt;/&gt; Copyright &copy; Chen's Blog (GH0ST.CN) 2016-2021</span> </div> <script src="/fancybox/lib/jquery-1.10.2.min.js"></script> <script type="text/javascript" src="/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script> <script> $(document).ready(function() { $("article img").each(function() { var strA = "<a style='text-decoration: none;' id='imgid' href='" + this.src + "'></a>"; $(this).wrapAll(strA); }); }); $("#imgid").fancybox({ openEffect : 'elastic', closeEffect : 'elastic', }); </script> </body> </html>
