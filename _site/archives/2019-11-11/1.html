<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1" /> <title>WebFuzzing方法和漏洞案例总结 · Chen's Blog</title> <meta name="description" content="WebFuzzing方法和漏洞案例总结"> <meta name="keywords" content="WebFuzzing方法和漏洞案例总结"> <link rel="icon" href="http://localhost:4000/assets/favicon.png"> <link rel="apple-touch-icon" href="http://localhost:4000/assets/touch-icon.png"> <link rel="stylesheet" href="http://localhost:4000/assets/core.css"> <link rel="canonical" href="http://localhost:4000/archives/2019-11-11/1"> <link rel="alternate" type="application/atom+xml" title="Chen's Blog" href="http://localhost:4000/feed.xml" /> <link href="/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" media="all" /> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?e4a42a371cc5994ee02b940034c29658"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script> </head> <body> <aside class="logo"> <a href="http://localhost:4000/"> <img src="/assets/avatar.jpg" class="logo-avatar"> </a> <span class="logo-prompt code">Back to Index</span> </aside> <article> <h1 class="title">EvilChen</h1> <div class="divider"></div> <center> <a href="https://github.com/gh0stkey" target="_blank">Github</a> | <a href="https://twitter.com/VulkeyChen" target="_blank">X (Twitter)</a> | <a href="/about" target="_blank">About</a> | <a href="/links" target="_blank">Links</a> </center> <div class="divider"></div> </article> <div id="content"> <article> <div class="center"> <h1 class="title">WebFuzzing方法和漏洞案例总结</h1> <time class="code">November 11, 2019</time> </div> <div class="divider"></div> <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&auto=1&id=1372323745&height=66"></iframe> <h1 id="webfuzzing方法和漏洞案例总结">WebFuzzing方法和漏洞案例总结</h1> <p>作者：Vulkey_Chen</p> <p>博客：gh0st.cn</p> <h2 id="背景">背景</h2> <p>之前有幸做过一次线下的议题分享《我的Web应用安全模糊测试之路》，讲解了一些常用的WebFuzzing技巧和案例，该议题得到了很大的回响，很多师傅们也与我进行了交流，但考虑到之前分享过很多思路非常不全面，这里以本篇文章作为一次总结，以实战引出技巧思路（方法）。</p> <p>我的Web应用安全模糊测试之路议题解读：<code class="language-plaintext highlighter-rouge">https://gh0st.cn/archives/2018-07-25/1</code> （推荐阅读）</p> <h2 id="实战案例">实战案例</h2> <p>以下分享的案例都是个人在参与项目或私密众测邀请时遇见的真实案例，案例大多基于个人收集和整理的<code class="language-plaintext highlighter-rouge">FuzzDict项目</code>（字典库）。</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/fuzzdict.png" alt="fuzzdict" /></p> <p>其中涉及的一些漏洞可能无法作为Fuzzing归类，这里也进行了强行的归类，只是想告诉大家漏洞挖掘中思路发散的重要性，个人也觉得比较经典。</p> <p><strong>注：</strong> 漏洞案例进行了脱敏以及细节上的修改。</p> <h3 id="案例-add">案例-Add</h3> <h4 id="sqli注入漏洞">[SQLi注入漏洞]</h4> <p>1.获得项目子域：<code class="language-plaintext highlighter-rouge">https://xxx.com</code></p> <p>2.目录扫描发现<code class="language-plaintext highlighter-rouge">/user/</code>目录，二层探测发现<code class="language-plaintext highlighter-rouge">/register</code>接口，其意为：“注册”</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722710437139.jpg" alt="-w538" /></p> <p>3.根据返回状态信息去Fuzz用户名、密码参数-&gt;结果：<code class="language-plaintext highlighter-rouge">uname\pwd</code></p> <p>4.对<code class="language-plaintext highlighter-rouge">uname参数</code>进行SQL注入测试，简单的逻辑判断存在</p> <p>5.注入点使用16进制的方式无法注入，SQLmap参数<code class="language-plaintext highlighter-rouge">--no-escape</code>即可绕过</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722712162025.jpg" alt="-w648" /></p> <h4 id="拒绝服务图片验证码">[拒绝服务]图片验证码</h4> <p>图片验证码DoS（拒绝服务攻击）这个思路很早就出来了，当时的第一想法就是采集样本收集参数，使用搜索引擎寻找存在图片验证码的点：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722714688846.jpg" alt="-w800" /></p> <p>根据这些点写了个脚本进行半自动的参数收集：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722718429294.jpg" alt="-w1134" /></p> <p>在漏洞挖掘的过程中，经常会抓取图片验证码的请求进行Fuzz：</p> <p>图片验证码地址：https://xxx/validateCode <img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722716485524.jpg" alt="-w606" /></p> <p>Fuzz存在潜藏参数，可控验证码生成大小：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722718790178.jpg" alt="-w706" /></p> <h4 id="jsonp无中生有">[JSONP]无中生有</h4> <p>获得一个敏感信息返回的请求端点：<code class="language-plaintext highlighter-rouge">http://xxx/getInfo</code></p> <p>使用<code class="language-plaintext highlighter-rouge">callback_dict.txt</code>字典进行Fuzz：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722720029660.jpg" alt="-w536" /></p> <p>成功发现<code class="language-plaintext highlighter-rouge">callback</code>这个潜藏参数：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722721391525.jpg" alt="-w907" /></p> <h4 id="逻辑漏洞响应变请求">[逻辑漏洞]响应变请求</h4> <p>这里同样是获得一个敏感信息返回的请求端点：<code class="language-plaintext highlighter-rouge">http://xxx/getInfo</code></p> <p>返回的信息如下所示：</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"responseData"</span><span class="p">:{</span><span class="nl">"userid"</span><span class="p">:</span><span class="s2">"user_id"</span><span class="p">,</span><span class="nl">"login"</span><span class="p">:</span><span class="s2">"user_name"</span><span class="p">,</span><span class="nl">"password"</span><span class="p">:</span><span class="s2">"user_password"</span><span class="p">,</span><span class="nl">"mobilenum"</span><span class="p">:</span><span class="s2">"user_mobilephone_number"</span><span class="p">,</span><span class="nl">"mobileisbound"</span><span class="p">:</span><span class="s2">"01"</span><span class="p">,</span><span class="nl">"email"</span><span class="p">:</span><span class="s2">"user_email_address"</span><span class="p">}}</span><span class="w">
</span></code></pre></div></div> <p>尝试了一些测试思路都无法发现安全漏洞，于是想到了<code class="language-plaintext highlighter-rouge">响应变请求</code>思路。</p> <p>将响应报文的JSON字段内容转化为HTTP请求的字段内容（BurpSuite插件项目：<code class="language-plaintext highlighter-rouge">https://github.com/gh0stkey/JSONandHTTPP</code>）：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722723549196.jpg" alt="" /></p> <p>将相关的信息字段内容替换为测试账号B的信息（例如：login=A -&gt; login=B）</p> <p>发现无法得到预期的越权漏洞，并尝试分析该网站其他请求接口对应的参数，发现都为大写，将之前的参数转换为大写：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722724827925.jpg" alt="" /></p> <p>继续Fuzz，结果却出人意料达到了预期：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722725077041.jpg" alt="" /></p> <h3 id="案例-update">案例-Update</h3> <h4 id="逻辑漏洞命名规律修改">[逻辑漏洞]命名规律修改</h4> <p>一个登录系统，跟踪JS文件发现了一些登录后的系统接口，找到其中的注册接口成功注册账户进入个人中心，用户管理处抓到如下请求：</p> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST URL: https://xxx/getRolesByUserId
POST Data: userId=1028
</span></code></pre></div></div> <p>返回如下信息：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722726547968.jpg" alt="-w1068" /></p> <p>可以看见这里的信息并不敏感，但根据测试发现userId参数可以进行越权遍历</p> <p>根据url判断这个请求的意思是根据用户id查看用户的身份，url中的驼峰方法(<strong>getRolesByUserId</strong>)惊醒了我，根据命名规则结构我将其修改成<strong>getUserByUserId</strong>，也就是根据用户id获取用户，也就成为了如下请求包。</p> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST URL: https://xxx/getUserByUserId
POST Data: userId=1028
</span></code></pre></div></div> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722727698302.jpg" alt="-w708" /></p> <p>成功返回了敏感信息，并通过修改userId可以越权获取其他用户的信息。</p> <h4 id="逻辑漏洞敏感的嗅觉">[逻辑漏洞]敏感的嗅觉</h4> <p>在测一个刚上线的APP时获得这样一条请求：</p> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">POST</span> <span class="nn">/mvc/h5/jd/mJSFHttpGWP</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s">……</span>

param={"userPin":"$Uid$","addressType":0}
</code></pre></div></div> <p>而这个请求返回的信息较为敏感，返回了个人的一些物理地址信息：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722729757171.jpg" alt="-w545" /></p> <p>在这里<code class="language-plaintext highlighter-rouge">param参数</code>是json格式的，其中<code class="language-plaintext highlighter-rouge">"userPin":"$Uid$"</code>引起我注意，敏感的直觉告诉我这里可以进行修改，尝试将<code class="language-plaintext highlighter-rouge">$Uid$</code>修改为其他用户的用户名、用户ID，成功越权：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722731124416.jpg" alt="-w560" /></p> <h4 id="逻辑漏洞熟能生巧">[逻辑漏洞]熟能生巧</h4> <p>收到一个项目邀请，全篇就一个后台管理系统。针对这个系统做了一些常规的测试之后除了发现一些 没用的弱口令外(无法登录系统的)没有了其他收获。</p> <p>分析这个后台管理系统的URL:<code class="language-plaintext highlighter-rouge">https://xxx/?m=index</code>，该URL访问解析过来 的是主⻚信息。</p> <p>尝试对请求参数<code class="language-plaintext highlighter-rouge">m</code>的值进行<code class="language-plaintext highlighter-rouge">Fuzz</code>，7K+的字典进行Fuzz，一段时间之后收获降临：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722732301271.jpg" alt="-w792" /></p> <p>获得了一个有用的请求:<code class="language-plaintext highlighter-rouge">?m=view</code>，该请求可以直接未授权获取信息：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722732785662.jpg" alt="-w741" /></p> <h3 id="案例-delete">案例-Delete</h3> <h4 id="逻辑漏洞token限制绕过">[逻辑漏洞]Token限制绕过</h4> <p>在测业务的密码重置功能，发送密码重置请求，邮箱收到一个重置密码的链接：<code class="language-plaintext highlighter-rouge">http://xxx/forget/pwd?userid=123&amp;token=xxxx</code></p> <p>这时候尝试删除token请求参数，再访问并成功重置了用户的密码：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722735366150.jpg" alt="-w234" /></p> <h4 id="sqli辅助参数删除报错">[SQLi辅助]参数删除报错</h4> <p>挖掘到一处注入，发现是root（DBA）权限：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722736532748.jpg" alt="-w457" /></p> <p>但这时候，找不到网站绝对路径，寻找网站用户交互的请求<code class="language-plaintext highlighter-rouge">http://xxx/xxxsearch?name=123</code>，删除<code class="language-plaintext highlighter-rouge">name=123</code>，网站报错获取绝对路径：</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722737353104.jpg" alt="-w460" /></p> <p>成功通过SQLi漏洞进行GetWebshell。</p> <p><img src="https://chen-blog-oss.oss-cn-beijing.aliyuncs.com/2019-11-11/15722737780009.jpg" alt="-w265" /></p> <h2 id="总结">总结</h2> <p>核心其实还是在于漏洞挖掘时的心细，一件事情理解透彻之后万物皆可Fuzz。</p> <p>平时注意字典的更新、整理和对实际情况的分析，再进行关联整合。</p> </article> <div class="page-navigation code"> <a class="next" href="http://localhost:4000/archives/2020-01-08/2" title="NEXT: 利用SourceMap还原网站原始代码(前端)">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="http://localhost:4000/" title="Back to Index">INDEX</a> <span> &middot; </span> <a class="prev" href="http://localhost:4000/archives/2019-08-21/1" title="PREV: 对某攻击队的Webshell进行分析">&gt;&gt;</a> </div> </div> <div class="footer"> <span class="block">&lt;/&gt; Copyright &copy; Chen's Blog (GH0ST.CN) 2016-2021</span> </div> <script src="/fancybox/lib/jquery-1.10.2.min.js"></script> <script type="text/javascript" src="/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script> <script> $(document).ready(function() { $("article img").each(function() { var strA = "<a style='text-decoration: none;' id='imgid' href='" + this.src + "'></a>"; $(this).wrapAll(strA); }); $(".block").html("&lt;/&gt; Copyright &copy; Chen's Blog (GH0ST.CN) 2016-" + (new Date()).getFullYear()); }); $("#imgid").fancybox({ openEffect : 'elastic', closeEffect : 'elastic', }); </script> </body> </html>
