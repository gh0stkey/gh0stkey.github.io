<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1" /> <title>浅析PDF事件导致的安全漏洞 · Chen's Blog</title> <meta name="description" content="浅析PDF事件导致的安全漏洞"> <meta name="keywords" content="浅析PDF事件导致的安全漏洞"> <link rel="icon" href="https://gh0st.cn/assets/favicon.png"> <link rel="apple-touch-icon" href="https://gh0st.cn/assets/touch-icon.png"> <link rel="stylesheet" href="/assets/css/fonts.css"> <link rel="stylesheet" href="/assets/css/highlight/github.min.css" id="highlight-light"> <link rel="stylesheet" href="/assets/css/highlight/github-dark.min.css" id="highlight-dark" disabled> <link rel="stylesheet" href="/assets/core.css"> <link rel="canonical" href="https://gh0st.cn/archives/2018-11-14/2"> <link rel="alternate" type="application/atom+xml" title="Chen's Blog" href="https://gh0st.cn/feed.xml" /> <link href="/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" media="all" /> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?e4a42a371cc5994ee02b940034c29658"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script> <script> window.giscusThemeConfig = { light: "light_protanopia", dark: "dark_tritanopia" }; </script> <script src="/assets/js/theme.js"></script> </head> <body> <button class="theme-toggle" id="themeToggle" aria-label="Switch Theme"> <!-- 太阳图标 (在深色模式显示) --> <svg id="icon-sun" viewBox="0 0 24 24"> <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z" /> </svg> <!-- 月亮图标 (在亮色模式显示) --> <svg id="icon-moon" viewBox="0 0 24 24" style="display: none"> <path d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.16,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.06,6.83,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z" /> </svg> </button> <aside class="logo"> <a href="https://gh0st.cn/"> <img src="/assets/avatar.jpg" class="logo-avatar"> </a> <span class="logo-prompt code">Back to Index</span> </aside> <article> <h1 class="title">EvilChen</h1> <div class="divider"></div> <center> <a href="/about" target="_blank">About Me</a> | <a href="/friends" target="_blank">My Friends</a> </center> <div class="divider"></div> </article> <div id="content"> <article> <div class="center"> <h1 class="title">浅析PDF事件导致的安全漏洞</h1> <time class="code">November 14, 2018</time> </div> <div class="divider"></div> <h1 id="浅析pdf事件导致的安全漏洞">浅析PDF事件导致的安全漏洞</h1> <p>最近ASRC的事情（<strong>PDF导致的URL跳转漏洞</strong>）闹的沸沸扬扬的，一开始没怎么去关注，后来想去玩一玩的时候发现作者没有给出比较好的说明来告诉大家如何玩、操作PDF的事件和漏洞原理。小白的我来探究一下。。</p> <h2 id="pdf事件添加">PDF事件添加</h2> <p>本人是macOS系统所以用不了迅捷PDF编辑器，后来尝试寻找各种适用于Mac平台的编辑器无果之后，还是向Adobe妥协，下载了<strong>破解版的Adobe Acrobat Pro DC 2018(也支持Windows)</strong>。</p> <p>随便用Word文档导出了一个PDF，使用Acrobat打开，进行编辑，找了一会终于找到了页面属性设置的地方。</p> <p>点击右侧的组织页面功能：</p> <p><img src="/images/2018-11-14-2/0.png" alt="pdf" /></p> <p>选择这一页点击更多-&gt;页面属性：</p> <p><img src="/images/2018-11-14-2/1.png" alt="pdf" /></p> <p>选择事件动作-&gt;触发器选择<strong>打开页面</strong>-&gt;选择动作<strong>打开网络链接</strong>-&gt;添加 输入地址：</p> <p><img src="/images/2018-11-14-2/2.png" alt="pdf" /></p> <p>设置成功：</p> <p><img src="/images/2018-11-14-2/3.png" alt="pdf" /></p> <h2 id="漏洞测试">漏洞测试</h2> <p>漏洞测试浏览器：谷歌浏览器 Chrome</p> <p>漏洞测试GIF：</p> <p><img src="/images/2018-11-14-2/4.gif" alt="test" /></p> <h2 id="why">Why？</h2> <p>这个漏洞的局限性在于浏览器的不同，那么为什么会只存在于部分浏览器上呢？</p> <h3 id="内核">内核？</h3> <p>一开始的猜想是与浏览器的内核有关，Chrome是基于Webkit的内核分支，而Safari也是基于这个的，但是经过测试发现发现Safari无法跳转。</p> <p>结果：NO</p> <h3 id="插件">插件？</h3> <p>之前了解过FireFox浏览器是使用pdf预览插件是Chrome的PDF Viewer，但是至今为止最新版都只是很久以前的版本了（火狐官方也进行了一些细微的修改）：</p> <p><img src="/images/2018-11-14-2/5.png" alt="plugin" /></p> <p>谷歌自己呢早就更新迭代了：</p> <p><code>chrome-extension://mhjfbmdgcfjbbpaeojofohoefgiehjai/pdf_viewer.js</code></p> <p><img src="/images/2018-11-14-2/6.png" alt="plugin" /></p> <p>结果：很大概率和浏览器PDF预览插件有关，可能是谷歌在之后更新引入了对PDF事件的支持。</p> <h1 id="end">END</h1> <p>PoC下载：<a href="https://gh0st.cn/file/poc.pdf">PoC.pdf</a></p> </article> <div class="page-navigation code"> <a class="next" href="https://gh0st.cn/archives/2018-11-14/1" title="NEXT: 一探短文件名">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="https://gh0st.cn/" title="Back to Index">INDEX</a> <span> &middot; </span> <a class="prev" href="https://gh0st.cn/archives/2018-10-28/3" title="PREV: Wfuzz高阶功法">&gt;&gt;</a> </div> <div class="comments"> <div id="giscus-container" class="giscus"></div> <script> (function() { const getTheme = () => { try { const savedTheme = localStorage.getItem('theme'); if (savedTheme) { return savedTheme; } } catch (e) {} if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) { return 'dark'; } const hour = new Date().getHours(); return (hour >= 6 && hour < 18) ? 'light' : 'dark'; }; const theme = getTheme(); const giscusTheme = theme === 'dark' ? 'dark_tritanopia' : 'light_protanopia'; const script = document.createElement('script'); script.src = "https://giscus.app/client.js"; script.setAttribute("data-repo", "gh0stkey/gh0stkey.github.io"); script.setAttribute("data-repo-id", "MDEwOlJlcG9zaXRvcnkzODc5NzEyMzU="); script.setAttribute("data-category", "Announcements"); script.setAttribute("data-category-id", "DIC_kwDOFx_4o84CyCUA"); script.setAttribute("data-mapping", "title"); script.setAttribute("data-strict", "0"); script.setAttribute("data-reactions-enabled", "0"); script.setAttribute("data-emit-metadata", "0"); script.setAttribute("data-input-position", "top"); script.setAttribute("data-lang", "zh-CN"); script.setAttribute("data-theme", giscusTheme); script.setAttribute("crossorigin", "anonymous"); script.async = true; document.getElementById('giscus-container').appendChild(script); })(); </script> </div> </div> <div class="footer"> <span class="block">&lt;/&gt; Copyright &copy; Chen's Blog (GH0ST.CN) 2016-2021</span> </div> <script src="/fancybox/lib/jquery-1.10.2.min.js"></script> <script type="text/javascript" src="/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script> <script> $(document).ready(function() { $("article img").each(function() { var strA = "<a style='text-decoration: none;' id='imgid' href='" + this.src + "'></a>"; $(this).wrapAll(strA); }); $(".block").html("&lt;/&gt; Copyright &copy; Chen's Blog (GH0ST.CN) 2016-" + (new Date()).getFullYear()); }); $("#imgid").fancybox({ openEffect : 'elastic', closeEffect : 'elastic', }); </script> <script src="/assets/js/highlight/highlight.min.js"></script> <script> document.addEventListener('DOMContentLoaded', function() { document.querySelectorAll('pre code[class*="language-"]').forEach(block => { hljs.highlightElement(block); }); }); const toggleHighlightTheme = () => { const theme = document.documentElement.getAttribute('data-theme'); const lightCss = document.getElementById('highlight-light'); const darkCss = document.getElementById('highlight-dark'); if (theme === 'dark') { lightCss.disabled = true; darkCss.disabled = false; } else { lightCss.disabled = false; darkCss.disabled = true; } }; document.addEventListener('DOMContentLoaded', toggleHighlightTheme); const observer = new MutationObserver(toggleHighlightTheme); observer.observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] }); </script> </body> </html>
